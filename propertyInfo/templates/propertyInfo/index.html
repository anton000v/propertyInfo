{% extends 'propertyInfo/base.html' %}

{% block title %}
    Properties List
{% endblock %}


{% block content %}
    {#    <!-- Latest compiled and minified CSS -->#}
    {#    <link rel="stylesheet"#}
    {#          href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">#}
    {##}
    {#    <!-- Latest compiled and minified JavaScript -->#}
    {#    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>#}
    {##}
    {#    <!-- Latest compiled and minified CSS -->#}
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">


    {#    <!-- (Optional) Latest compiled and minified JavaScript translation files -->#}
    {#    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/i18n/defaults-*.min.js"></script>#}

    <h1>Новострои</h1>
    <h3>Фильтр поиска</h3>
    <form method="GET" action=".">
        <div class="form-row">
            <div class="form-group col-12">
                <div class="input-group ">
                    {#                    <div class="input-group-prepend">#}
                    {#                        <span class="input-group-text" id="basic-addon1">@</span>#}
                    {#                    </div>#}
                    <input class="form-control py-2 border-right-0 border" type="search" name="name_contains"
                           value="{{ name_contains_query }}"
                           placeholder="Имя..."/>
                    {#                    <span class="input-group-append">#}
                    {#                        <div class="input-group-text bg-transparent">#}
                    {#                            <i class="fa fa-search"></i>#}
                    {#                        </div>#}
                    {#                    </span>#}
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-12">
                <div class="input-group">
                    <input class="form-control py-2 border-right-0 border" type="search" name="address_contains"
                           value="{{ address_contains_query }}"
                           placeholder="Адресс..."/>
                    {#                    <span class="input-group-append">#}
                    {#                        <div class="input-group-text bg-transparent">#}
                    {#                            <i class="fa fa-search"></i>#}
                    {#                        </div>#}
                    {#                    </span>#}
                </div>
            </div>
        </div>
        {#        <div class="form-row">#}
        {#            <div class="form-group col-12">#}
        {#                <div class="input-group">#}
        {#                    <select name="district_contains" type="search" id="district_contains"#}
        {#                            class="selectpicker"#}
        {#                            data-live-search="true"#}
        {#                            data-display="static"#}
        {#                            data-size="5"#}
        {#                            style="width:auto;">#}
        {#                        {% for district in districts %}#}
        {#                            {% if district == district_contains_query %}#}
        {#                                <option selected="selected">{{ district }}</option>#}
        {#                            {% else %}#}
        {#                                <option>{{ district }}</option>#}
        {#                            {% endif %}#}
        {##}
        {#                        {% endfor %}#}
        {##}
        {##}
        {#                    </select>#}
        {#                </div>#}
        {#            </div>#}
        {#        </div>#}
        <div class="form-row">
            <div class="form-group col-12">
{#                <div class="input-group">#}
                    <select name="district_contains-select" type="search" id="district_contains-select"
                            data-none-results-text="Такого нет: {0}"
                            class="selectpicker"
                            data-live-search="true"
                            data-display="static"
                            data-size="6"
                            style="width:auto;">

                        <option value={{ districts.0.0 }}>Любой район</option>
                        {% for district in districts|slice:"1:" %}
                            <optgroup label="{{ district.0 }}">
                                {% for district_name in district.1 %}
                                    {% if district_name.0 == district_contains_query %}
                                        <option value="{{ district_name.0 }}"
                                                selected="selected">{{ district_name.1 }}</option>
                                    {% else %}
                                        <option value="{{ district_name.0 }}">{{ district_name.1 }}</option>
                                    {% endif %}
                                {% endfor %}
                            </optgroup>
                        {% endfor %}


                    </select>
{#                </div>#}
            </div>
        </div>
        {#        <div class="form-row">#}
        {#            <div class="form-group col-12">#}
        {#                <div class="input-group">#}
        {#                    <select name="district_contains2" type="search" id="district_contains2"#}
        {#                            class="selectpicker"#}
        {#                            data-live-search="true"#}
        {#                            data-display="static"#}
        {#                            data-size="5"#}
        {#                            style="width:auto;">#}
        {#                        {% for district, in districts %}#}
        {#                            {% if district == district_contains_query %}#}
        {#                                <option selected="selected">{{ district }}</option>#}
        {#                            {% else %}#}
        {#                                <option>{{ district }}</option>#}
        {#                            {% endif %}#}
        {##}
        {#                        {% endfor %}#}
        {##}
        {##}
        {#                    </select>#}
        {#                </div>#}
        {#            </div>#}
        {#        </div>#}
        <div class="form-row">
            <div class="form-group col-12">
                <div class="input-group">
                    <input class="form-control py-2 border-right-0 border" type="search" name="developer_contains"
                           value="{{ developer_contains_query }}"
                           placeholder="Застройщик..."/>
                    {#                    <span class="input-group-append">#}
                    {#                        <div class="input-group-text bg-transparent">#}
                    {#                            <i class="fa fa-search"></i>#}
                    {#                        </div>#}
                    {#                    </span>#}
                </div>
            </div>
        </div>

{#        <div class="form-row">#}
{#            <div class="form-group col-12">#}
{#                <div class="input-group">#}
{#                    <div class="dropdown">#}
{#                        <button onclick="myFunction()" class="dropbtn">Dropdown</button>#}
{#                        <div id="myDropdown" class="dropdown-content">#}
{#                            <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">#}
{#                            <a href="#about">About</a>#}
{#                            <a href="#base">Base</a>#}
{#                            <a href="#blog">Blog</a>#}
{#                            <a href="#contact">Contact</a>#}
{#                            <a href="#custom">Custom</a>#}
{#                            <a href="#support">Support</a>#}
{#                            <a href="#tools">Tools</a>#}
{#                        </div>#}
{#                    </div>#}
                    {#                    <span class="input-group-append">#}
                    {#                        <div class="input-group-text bg-transparent">#}
                    {#                            <i class="fa fa-search"></i>#}
                    {#                        </div>#}
                    {#                    </span>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
        <button type="button" class="btn btn-default mb-3" data-toggle="collapse" data-target="#collapseExample"
                aria-expanded="false" aria-controls="collapseExample">
            Расширенный поиск
        </button>

        <div class="collapse" id="collapseExample">
            {#  <div class="card card-body">#}
            <div class="form-row">
                <div class="form-group col-md-2 col-lg-2">
                    <label for="viewCountMin">Minimum View Count</label>
                    <input type="number" min=0 class="form-control" id="viewCountMin" placeholder="0"
                           name="view_count_min">
                </div>
                <div class="form-group col-md-2 col-lg-2">
                    <label for="viewCountMax">Maximum View Count</label>
                    <input type="number" min=0 class="form-control" id="viewCountMax" placeholder="10000?"
                           name="view_count_max">
                </div>
                <div class="form-group col-md-2 col-lg-2">
                    <label for="publishDateMin">Publish date minimum</label>
                    <input type="date" class="form-control" id="publishDateMin" name="date_min">
                </div>
                <div class="form-group col-md-2 col-lg-2">
                    <label for="publishDateMax">Publish date maximum</label>
                    <input type="date" class="form-control" id="publishDateMax" name="date_max">
                </div>
                <div class="form-group col-md-4">
                    <label for="category">Category</label>
                    <select id="category" class="form-control" name="category">
                        <option selected>Choose...</option>
                        {% for cat in districts %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="reviewed" name="reviewed">
                    <label class="form-check-label" for="reviewed">
                        Reviewed
                    </label>
                </div>
            </div>
            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="notReviewed" name="notReviewed">
                    <label class="form-check-label" for="notReviewed">
                        Not reviewed
                    </label>
                </div>
            </div>
            {#  </div>#}
        </div>
        <button type="submit" class="btn btn-primary btn-block">Поиск</button>
        {#        <input type="button" value="Update" id="selection-button" method="GET">#}
    </form>

    <hr/>

    <div id="cards_container">
        {#        НЕ РАБОТАЕТ#}
        {% if not buildings_page %}
            <h2 align="center">Извините, таких не найдено</h2>
            <p align="center">Возможно, вы допустили ошибку?</p>
        {% endif %}
        <div class="row">
            {% for building in buildings_page.object_list %}
                <div class="col-sm-12 col-md-6 col-lg-4 mb-5">
                    <div class="card text-center">

                        {% if building.buildingImages.first.buildingImage %}
                            <img class="card-img-top" src="{{ building.buildingImages.first.buildingImage.url }}"
                                 alt="Card image">
                        {% endif %}
                        <div class="card-body">
                            <h2 class="card-title">{{ building.name }}</h2>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">Адрес: {{ building.address }}</li>
                                <li class="list-group-item">Район: {{ building.get_district_display }}</li>
                                <li class="list-group-item">Застройщик: {{ building.developer }}</li>
                            </ul>
                            <a href="{{ building.get_absolute_url }}"
                               class="stretched-link text-danger">Открыть</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        {% if is_paginated %}
            <nav aria-label="...">
                <ul class="pagination">
                    <li class="page-item {% if not previous_page_url %} disabled {% endif %}">
                        <a class="page-link" href="{{ previous_page_url }}" tabindex="-1"><span
                                class="glyphicon glyphicon-arrow-left"></span></a>
                    </li>

                    {% for n in buildings_page.paginator.page_range %}
                        {% if buildings_page.number == n %}
                            <li class="page-item active">
                                <a class="page-link" href="?page={{ n }}">{{ n }}<span class="sr-only">(current)</span></a>
                            </li>
                        {% elif n > buildings_page.number|add:-4 and n < buildings_page.number|add:+4 %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ n }}">{{ n }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    <li class="page-item {% if not next_page_url %} disabled {% endif %}">
                        <a class="page-link" href="{{ next_page_url }}" tabindex="-1"><span
                                class="glyphicon glyphicon-arrow-right"></span></a>
                    </li>
                </ul>
            </nav>
        {% endif %}


    </div>

{% endblock %}

{% block custom_js %}
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>

    <!-- (Optional) Latest compiled and minified JavaScript translation files -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/i18n/defaults-*.min.js"></script>

{#    --------------- Для зеленого dropdown#}
{#    <script type="text/javascript">#}
{##}
{#        /* When the user clicks on the button,#}
{#        toggle between hiding and showing the dropdown content */#}
{#        function myFunction() {#}
{#            document.getElementById("myDropdown").classList.toggle("show");#}
{#        }#}
{##}
{#        function filterFunction() {#}
{#            var input, filter, ul, li, a, i;#}
{#            input = document.getElementById("myInput");#}
{#            filter = input.value.toUpperCase();#}
{#            div = document.getElementById("myDropdown");#}
{#            a = div.getElementsByTagName("a");#}
{#            for (i = 0; i < a.length; i++) {#}
{#                txtValue = a[i].textContent || a[i].innerText;#}
{#                if (txtValue.toUpperCase().indexOf(filter) > -1) {#}
{#                    a[i].style.display = "";#}
{#                } else {#}
{#                    a[i].style.display = "none";#}
{#                }#}
{#            }#}
{#        }#}
{##}
{#    </script>#}
    {# -----------------Для ajax обновлния данных #}
    {#    <script type="text/javascript">#}
    {#        $("#selection-button").click(function (event) {#}
    {#            console.log("Ajax request send properly")#}
    {#            event.preventDefault();#}
    {#            var districtSelected = $('#district_contains').find(":selected").val();#}
    {##}
    {#            console.log('aa', districtSelected)#}
    {#            $.ajax({#}
    {#                url: "{% url 'update_content' %}",#}
    {#                method: 'GET',#}
    {#                data: {#}
    {#                    district_contains: districtSelected#}
    {##}
    {#                },#}
    {#                success: function (data) {#}
    {#                    console.log(data)#}
    {#                    $('#cards_container').html(data);#}
    {#                },#}
    {#                error: function (error_data) {#}
    {#                    console.log("error")#}
    {#                    console.log(error_data)#}
    {#                }#}
    {#            })#}
    {#        });#}
    {#    </script>#}

    {#    Для смены надписи в селекторе:#}
    {#    <script type="text/javascript">#}
    {#            $('#district_contains-select').selectpicker({#jq}#}
    {#            noneResultsText: 'I found no results'#}
    {#        });#}


    {#</script>#}

{% endblock %}

